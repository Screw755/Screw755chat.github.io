<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Anonymous Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .custom-scrollbar::-webkit-scrollbar { width: 8px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #888; border-radius: 10px; }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #555; }
  </style>
</head>
<body class="bg-gray-50 dark:bg-gray-800">

  <!-- Header -->
  <header class="bg-gradient-to-r from-purple-600 to-indigo-700 text-white p-4 shadow-lg rounded-b-lg text-center">
    <h1 class="text-3xl font-bold">Anonymous Chat</h1>
    <p class="text-sm mt-1">Your ID: <span id="userId" class="font-mono bg-purple-700 px-2 py-1 rounded-full text-xs"></span></p>
  </header>

  <!-- Messages -->
  <main id="messages" class="flex-1 overflow-y-auto p-4 space-y-4 custom-scrollbar" style="height: 70vh;">
    <div class="text-center text-gray-500 mt-10">Loading messages...</div>
  </main>

  <!-- Input -->
  <footer class="p-4 bg-white border-t border-gray-200 shadow-inner rounded-t-lg">
    <form id="chatForm" class="flex space-x-3">
      <input id="messageInput" type="text" placeholder="Type your anonymous message..."
        class="flex-1 p-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-purple-500 transition duration-200 ease-in-out" required/>
      <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transform transition duration-200 ease-in-out hover:scale-105">
        Send
      </button>
    </form>
  </footer>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>

  <script>
    // TODO: Replace with your Firebase config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.getAuth();
    const db = firebase.getFirestore();

    let currentUserId = '';

    // Sign in anonymously
    firebase.signInAnonymously(auth)
      .then(() => console.log("Signed in anonymously"))
      .catch((err) => console.error(err));

    // Listen for auth state changes
    firebase.onAuthStateChanged(auth, (user) => {
      if (user) {
        currentUserId = user.uid;
        document.getElementById('userId').textContent = currentUserId;
        loadMessages();
      }
    });

    // Load messages
    function loadMessages() {
      const messagesRef = firebase.collection(db, 'messages');
      const q = firebase.query(messagesRef, firebase.orderBy('timestamp'));
      
      firebase.onSnapshot(q, (snapshot) => {
        const messagesContainer = document.getElementById('messages');
        messagesContainer.innerHTML = '';
        snapshot.forEach((doc) => {
          const msg = doc.data();
          const messageDiv = document.createElement('div');
          const isOwn = msg.userId === currentUserId;
          messageDiv.className = `flex ${isOwn ? 'justify-end' : 'justify-start'}`;
          messageDiv.innerHTML = `
            <div class="max-w-[70%] p-3 rounded-xl shadow-md ${isOwn ? 'bg-blue-500 text-white rounded-br-none' : 'bg-gray-200 text-gray-900 rounded-bl-none'}">
              <div class="font-semibold text-sm mb-1 opacity-80">
                ${isOwn ? 'You' : 'User ' + msg.userId.substring(0, 8) + '...'}
              </div>
              <p class="text-base break-words">${msg.text}</p>
              <div class="text-xs mt-1 text-right opacity-70">
                ${msg.timestamp?.toDate ? msg.timestamp.toDate().toLocaleTimeString() : 'Sending...'}
              </div>
            </div>
          `;
          messagesContainer.appendChild(messageDiv);
        });
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      });
    }

    // Send message
    document.getElementById('chatForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const messageInput = document.getElementById('messageInput');
      if (!messageInput.value.trim()) return;

      firebase.addDoc(firebase.collection(db, 'messages'), {
        text: messageInput.value,
        userId: currentUserId,
        timestamp: firebase.serverTimestamp()
      }).then(() => {
        messageInput.value = '';
      }).catch((err) => console.error("Error sending message:", err));
    });
  </script>

</body>
</html>
